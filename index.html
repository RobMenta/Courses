<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0b0f14" />
  <meta name="description" content="Liste de course (PWA) : coche, quantitÃ©, prix, total, glisser-dÃ©poser. Recettes & budget via IA." />

  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="icon" href="assets/icon-192.png" sizes="192x192" />
  <link rel="apple-touch-icon" href="assets/icon-192.png" />
  <link rel="stylesheet" href="styles.css" />

  <title>Liste de course</title>
</head>

<body>
  <!-- Topbar -->
  <header class="topbar">
    <div class="brand">
      <div class="brand__dot" aria-hidden="true"></div>
      <div class="brand__text">
        <div class="brand__title">Liste de course</div>
        <div class="brand__sub">ğŸŸ¢ Offline â€¢ ğŸ“² Ã‰cran dâ€™accueil â€¢ ğŸ§® Total auto</div>
      </div>
    </div>

    <div class="topbar__actions">
      <button id="btnSettings" class="icon-btn" aria-label="RÃ©glages" title="RÃ©glages">âš™ï¸</button>
    </div>
  </header>

  <!-- Tabs -->
  <nav class="tabs" role="tablist" aria-label="Navigation">
    <button class="tab is-active" data-tab="list" role="tab" aria-selected="true">
      ğŸ›’ <span>Liste</span>
    </button>
    <button class="tab" data-tab="recipes" role="tab" aria-selected="false">
      ğŸ³ <span>Recettes â†’ Liste</span>
    </button>
    <button class="tab" data-tab="budget" role="tab" aria-selected="false">
      ğŸ’¶ <span>Budget â†’ Liste</span>
    </button>
  </nav>

  <main class="container">
    <!-- ===================== -->
    <!-- ğŸ›’ LISTE -->
    <!-- ===================== -->
    <section id="tab-list" class="panel is-active" role="tabpanel">
      <div class="panel__header">
        <div class="panel__title">
          <h2>ğŸ›’ Ta liste</h2>
          <p class="muted">
            Coche âœ…, ajuste la quantitÃ© ğŸ”¢, mets ton prix ğŸ’¶, et le total se calcule tout seul.
            Tu peux aussi glisser â˜° pour rÃ©ordonner.
          </p>
        </div>

        <div class="panel__actions">
          <button id="btnGenRecipesFromList" class="btn btn-primary">
            âœ¨ GÃ©nÃ©rer recettes avec ce que jâ€™ai cochÃ©
          </button>
          <button id="btnUncheckAll" class="btn btn-ghost">ğŸ§¼ Tout dÃ©cocher</button>
          <button id="btnResetPrices" class="btn btn-ghost">ğŸ§¾ Vider prix</button>
          <button id="btnResetAll" class="btn btn-danger">ğŸ”¥ Reset</button>
        </div>
      </div>

      <!-- Liste rendue par app.js -->
      <div class="list-wrapper">
        <div class="legend">
          <div class="legend__item"><span class="chip">â˜°</span> glisse</div>
          <div class="legend__item"><span class="chip">âœ…</span> coche</div>
          <div class="legend__item"><span class="chip">Ã—</span> quantitÃ©</div>
          <div class="legend__item"><span class="chip">â‚¬</span> prix</div>
        </div>

        <ul id="itemsList" class="items" aria-label="Liste de course"></ul>
      </div>

      <!-- Ajout rapide -->
      <div class="add-row" id="addRow" hidden>
        <input id="addName" class="input" type="text" placeholder="Nom du produitâ€¦" />
        <button id="btnAddConfirm" class="btn btn-primary">â• Ajouter</button>
        <button id="btnAddCancel" class="btn btn-ghost">Annuler</button>
      </div>

      <div class="spacer-bottom" aria-hidden="true"></div>
    </section>

    <!-- ===================== -->
    <!-- ğŸ³ RECETTES â†’ LISTE -->
    <!-- ===================== -->
    <section id="tab-recipes" class="panel" role="tabpanel">
      <div class="panel__header">
        <div class="panel__title">
          <h2>ğŸ³ Recettes â†’ Liste</h2>
          <p class="muted">
            Lâ€™IA te propose des recettes qui â€œfonctionnent vraimentâ€, puis tu peux
            <b>appliquer</b> : Ã§a coche / ajoute / met les quantitÃ©s dans ta liste ğŸ›’
          </p>
        </div>
      </div>

      <div class="card">
        <h3 class="card__title">1) IdÃ©es Ã  partir de ce que tu as cochÃ©</h3>
        <div class="row">
          <button class="btn btn-primary" data-ai="suggest_from_checked">
            ğŸ§  IdÃ©es recettes (avec ma sÃ©lection)
          </button>
          <button class="btn btn-ghost" data-ai="suggest_plus_2">
            ğŸ›ï¸ IdÃ©es + 1â€“2 achats max
          </button>
        </div>

        <div class="divider"></div>

        <h3 class="card__title">2) Une envie â†’ liste automatique</h3>
        <p class="muted small">Ex : â€œpÃ¢tes carbo healthyâ€, â€œwraps protÃ©inÃ©sâ€, â€œsalade rapideâ€â€¦</p>
        <textarea id="aiPromptRecipes" class="textarea" rows="4" placeholder="Ã‰cris ton envie iciâ€¦"></textarea>

        <div class="row">
          <button class="btn btn-primary" data-ai="plan_recipe">âœ¨ GÃ©nÃ©rer + prÃ©parer la liste</button>
          <button id="btnClearAiRecipes" class="btn btn-ghost">ğŸ§½ Effacer</button>
        </div>

        <div class="ai-output">
          <div class="ai-output__head">
            <div class="ai-output__title">ğŸ“Œ RÃ©sultat</div>
            <button id="btnApplyAi" class="btn btn-primary" disabled>âœ… Appliquer Ã  ma liste</button>
          </div>
          <pre id="aiOutRecipes" class="pre">â€”</pre>
        </div>
      </div>

      <div class="spacer-bottom" aria-hidden="true"></div>
    </section>

    <!-- ===================== -->
    <!-- ğŸ’¶ BUDGET â†’ LISTE -->
    <!-- ===================== -->
    <section id="tab-budget" class="panel" role="tabpanel">
      <div class="panel__header">
        <div class="panel__title">
          <h2>ğŸ’¶ Budget â†’ Liste (semaine)</h2>
          <p class="muted">
            Tu mets un budget + un objectif : lâ€™IA propose une semaine de courses.
            Ensuite tu peux <b>appliquer</b> : Ã§a coche / ajoute / quantitÃ©s dans ta liste ğŸ›’
          </p>
        </div>
      </div>

      <div class="card">
        <div class="grid2">
          <div>
            <label class="label">Budget (â‚¬)</label>
            <input id="budgetValue" class="input" inputmode="decimal" placeholder="Ex: 80" />
          </div>
          <div>
            <label class="label">Objectif</label>
            <select id="budgetGoal" class="select">
              <option value="equilibre">ğŸ¥— Ã‰quilibrÃ©</option>
              <option value="proteine">ğŸ’ª ProtÃ©inÃ©</option>
              <option value="perte_de_poids">ğŸ”¥ Perte de poids</option>
            </select>
          </div>
        </div>

        <label class="label">Contraintes (optionnel)</label>
        <textarea id="aiPromptBudget" class="textarea" rows="3"
          placeholder="Ex : pas de porc, pas de lactose, rapide, + lÃ©gumesâ€¦"></textarea>

        <div class="row">
          <button class="btn btn-primary" data-ai="weekly_plan">ğŸ§¾ GÃ©nÃ©rer semaine</button>
          <button id="btnClearAiBudget" class="btn btn-ghost">ğŸ§½ Effacer</button>
        </div>

        <div class="ai-output">
          <div class="ai-output__head">
            <div class="ai-output__title">ğŸ“Œ RÃ©sultat</div>
            <button id="btnApplyBudget" class="btn btn-primary" disabled>âœ… Appliquer Ã  ma liste</button>
          </div>
          <pre id="aiOutBudget" class="pre">â€”</pre>
        </div>
      </div>

      <div class="spacer-bottom" aria-hidden="true"></div>
    </section>
  </main>

  <!-- Footer total (sticky) -->
  <footer class="footer-total" aria-label="Total">
    <div class="footer-total__left">
      <div class="footer-total__label">ğŸ§® Total cochÃ©</div>
      <div class="footer-total__value">
        <span id="totalValue">0,00</span> <span class="footer-total__eur">â‚¬</span>
      </div>
      <div id="totalHint" class="footer-total__hint">Coche + prix + quantitÃ© â†’ total auto.</div>
    </div>

    <div class="footer-total__right">
      <button id="btnAddQuick" class="btn btn-primary">â• Ajouter</button>
    </div>
  </footer>

  <!-- Settings dialog -->
  <dialog id="settingsDialog" class="dialog">
    <form method="dialog" class="dialog__form">
      <div class="dialog__header">
        <h3>âš™ï¸ RÃ©glages</h3>
        <button class="icon-btn" value="cancel" aria-label="Fermer">âœ–ï¸</button>
      </div>

      <div class="dialog__body">
        <label class="label">URL backend IA</label>
        <input id="aiEndpoint" class="input" placeholder="https://shopping-ai-worker.coursesrob.workers.dev/ai" />

        <div class="muted small" style="margin-top:8px;">
          ğŸ’¡ Ton IA doit rester cÃ´tÃ© serveur (Worker). Ne mets jamais une clÃ© API dans lâ€™app.
        </div>

        <div class="divider" style="margin:14px 0;"></div>

        <div class="grid2">
          <div>
            <label class="label">QuantitÃ© max</label>
            <select id="qtyMax" class="select">
              <option>6</option>
              <option selected>10</option>
              <option>15</option>
              <option>20</option>
            </select>
          </div>

          <div>
            <label class="label">Devise</label>
            <select id="currency" class="select">
              <option value="EUR">EUR (â‚¬)</option>
            </select>
          </div>
        </div>
      </div>

      <div class="dialog__footer">
        <button id="btnSaveSettings" class="btn btn-primary" value="default">âœ… Enregistrer</button>
        <button class="btn btn-ghost" value="cancel">Annuler</button>
      </div>
    </form>
  </dialog>

  <script src="app.js"></script>
</body>
</html>
