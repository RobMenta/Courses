<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0b0f14" />
  <title>Liste de course</title>

  <link rel="manifest" href="./manifest.webmanifest" />
  <link rel="apple-touch-icon" href="./assets/icon-192.png" />

  <!-- IMPORTANT: chemins en ./ + petit cache-bust -->
  <link rel="stylesheet" href="./styles.css?v=7" />

  <!-- Safety net: si jamais le CSS ne charge pas, au moins les panels se cachent -->
  <style>
    .panel{display:none}
    .panel.is-active{display:block}
  </style>
</head>

<body>
  <header class="topbar">
    <div class="brand">
      <div class="brand__dot" aria-hidden="true"></div>
      <div>
        <div class="brand__title">Liste de course</div>
        <div class="brand__sub">ğŸŸ¢ Offline â€¢ ğŸ“² Ã‰cran dâ€™accueil â€¢ ğŸ§® Total auto</div>
      </div>
    </div>

    <button class="icon-btn" id="btnSettings" title="RÃ©glages">âš™ï¸</button>
  </header>

  <main class="container">
    <!-- Tabs -->
    <nav class="tabs" role="tablist" aria-label="Navigation">
      <button class="tab is-active" role="tab" aria-selected="true" data-tab="list">ğŸ›’ Liste</button>
      <button class="tab" role="tab" aria-selected="false" data-tab="recipes">ğŸ³ Recettes â†’ Liste</button>
      <button class="tab" role="tab" aria-selected="false" data-tab="budget">ğŸ’¶ Budget â†’ Liste</button>
    </nav>

    <!-- Panel: LIST -->
    <section class="panel is-active" id="tab-list" role="tabpanel">
      <div class="panel__header">
        <h2 style="margin:0 0 6px 0;">ğŸ›’ Ta liste</h2>
        <div class="muted">
          Coche âœ…, ajuste la quantitÃ© ğŸ”¢, mets ton prix ğŸ’¶, et le total se calcule tout seul.
          Tu peux aussi glisser â˜° pour rÃ©ordonner.
        </div>
      </div>

      <div class="summary">
        <div class="summary__card">
          <div class="summary__label">ğŸ§® Total cochÃ©</div>
          <div class="summary__value"><span id="totalValue">0,00</span> â‚¬</div>
          <div class="summary__hint" id="totalHint">Coche un produit + saisis un prix pour lâ€™ajouter au total.</div>
        </div>

        <div class="summary__actions">
          <button class="btn" data-ai="suggest_from_checked" title="Recettes depuis ce que tu as cochÃ©">
            âœ¨ GÃ©nÃ©rer recettes avec ce que jâ€™ai cochÃ©
          </button>
          <button class="btn btn-ghost" id="btnUncheckAll">ğŸ§¼ Tout dÃ©cocher</button>
          <button class="btn btn-ghost" id="btnResetPrices">ğŸ§¾ Vider prix</button>
          <button class="btn btn-danger" id="btnResetAll">ğŸ”¥ Reset</button>
        </div>
      </div>

      <div class="list-wrapper">
        <div class="legend">
          <div class="legend__item"><span class="chip">â˜°</span> glisse</div>
          <div class="legend__item"><span class="chip">âœ…</span> coche</div>
          <div class="legend__item"><span class="chip">Ã—</span> quantitÃ©</div>
          <div class="legend__item"><span class="chip">â‚¬</span> prix</div>
        </div>

        <ul class="items" id="itemsList"></ul>

        <div class="add-row">
          <button class="btn btn-ghost" id="btnAddQuick">â• Ajouter</button>

          <form id="addRow" hidden style="display:flex; gap:10px; flex:1;">
            <input class="input" id="addName" placeholder="Nom du produitâ€¦" autocomplete="off" />
            <button class="btn" id="btnAddConfirm">Ajouter</button>
            <button class="btn btn-ghost" id="btnAddCancel">Annuler</button>
          </form>
        </div>
      </div>
    </section>

    <!-- Panel: RECIPES -->
    <section class="panel" id="tab-recipes" role="tabpanel">
      <div class="panel__header">
        <h2 style="margin:0 0 6px 0;">ğŸ³ Recettes â†’ Liste</h2>
        <div class="muted">
          Lâ€™IA te propose des recettes qui â€œfonctionnent vraimentâ€, puis tu peux appliquer : Ã§a coche / ajoute / met les quantitÃ©s dans ta liste ğŸ›’
        </div>
      </div>

      <div class="ai-box">
        <div class="label">1) IdÃ©es Ã  partir de ce que tu as cochÃ©</div>
        <div class="ai-actions">
          <button class="btn" data-ai="suggest_from_checked">ğŸ§  IdÃ©es recettes (avec ma sÃ©lection)</button>
          <button class="btn btn-ghost" data-ai="suggest_plus_missing">ğŸ›ï¸ IdÃ©es + 1â€“2 achats max</button>
        </div>

        <hr class="hr" />

        <div class="label">2) Une envie â†’ liste automatique</div>
        <div class="muted small">Ex : â€œpÃ¢tes carbo healthyâ€, â€œwraps protÃ©inÃ©sâ€, â€œsalade rapideâ€â€¦</div>

        <div class="toolbar">
          <input class="input" id="aiPromptRecipes" placeholder="Ã‰cris ton envie iciâ€¦" />
          <button class="btn" data-ai="plan_recipe">âœ¨ GÃ©nÃ©rer + prÃ©parer la liste</button>
          <button class="btn btn-ghost" id="btnClearAi">ğŸ§½ Effacer</button>
        </div>

        <div class="ai-output">
          <div class="ai-output__title">ğŸ“Œ RÃ©sultat</div>
          <pre class="pre" id="aiOutRecipes">â€”</pre>

          <div class="ai-output__actions">
            <button class="btn" id="btnApplyAi" disabled>âœ… Appliquer Ã  ma liste</button>
          </div>
        </div>
      </div>
    </section>

    <!-- Panel: BUDGET -->
    <section class="panel" id="tab-budget" role="tabpanel">
      <div class="panel__header">
        <h2 style="margin:0 0 6px 0;">ğŸ’¶ Budget â†’ Liste (semaine)</h2>
        <div class="muted">
          Tu mets un budget + un objectif : lâ€™IA propose une semaine de courses. Ensuite tu peux appliquer : Ã§a coche / ajoute / quantitÃ©s dans ta liste ğŸ›’
        </div>
      </div>

      <div class="ai-box">
        <div class="grid2">
          <div>
            <label class="label" for="budgetValue">Budget (â‚¬)</label>
            <input class="input" id="budgetValue" placeholder="Ex: 80" inputmode="decimal" />
          </div>

          <div>
            <label class="label" for="budgetGoal">Objectif</label>
            <select class="select" id="budgetGoal">
              <option value="equilibre">ğŸ¥— Ã‰quilibrÃ©</option>
              <option value="proteine">ğŸ’ª ProtÃ©inÃ©</option>
              <option value="perte_poids">ğŸ”¥ Perte de poids</option>
            </select>
          </div>
        </div>

        <label class="label" for="aiPromptBudget">Contraintes (optionnel)</label>
        <textarea class="textarea" id="aiPromptBudget" rows="3" placeholder="Ex : pas de porc, pas de lactose, rapide, + lÃ©gumesâ€¦"></textarea>

        <div class="ai-actions" style="margin-top:10px;">
          <button class="btn" data-ai="weekly_plan">ğŸ§¾ GÃ©nÃ©rer semaine</button>
          <button class="btn btn-ghost" id="btnClearAi">ğŸ§½ Effacer</button>
        </div>

        <div class="ai-output">
          <div class="ai-output__title">ğŸ“Œ RÃ©sultat</div>
          <pre class="pre" id="aiOutBudget">â€”</pre>
          <div class="ai-output__actions">
            <button class="btn" id="btnApplyAi" disabled>âœ… Appliquer Ã  ma liste</button>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Settings dialog -->
  <dialog class="dialog" id="settingsDialog">
    <form class="dialog__form" method="dialog">
      <div class="dialog__header">
        <div style="font-weight:1000;">âš™ï¸ RÃ©glages</div>
        <button class="icon-btn" value="cancel">âœ•</button>
      </div>

      <div class="dialog__body">
        <label class="label" for="aiEndpoint">URL Backend IA (Worker /ai)</label>
        <input class="input" id="aiEndpoint" placeholder="https://...workers.dev/ai" />

        <div class="grid2" style="margin-top:10px;">
          <div>
            <label class="label" for="currency">Devise</label>
            <input class="input" id="currency" value="EUR" disabled />
          </div>

          <div>
            <label class="label" for="qtyMax">QuantitÃ© max (menu)</label>
            <input class="input" id="qtyMax" type="number" min="2" max="50" value="10" />
          </div>
        </div>

        <div class="muted small" style="margin-top:10px;">
          âœ… La liste marche offline. <br/>
          ğŸ¤– Lâ€™IA nÃ©cessite Internet + backend.
        </div>
      </div>

      <div class="dialog__footer">
        <button class="btn btn-ghost" value="cancel">Annuler</button>
        <button class="btn" id="btnSaveSettings" value="default">Enregistrer</button>
      </div>
    </form>
  </dialog>

  <script src="./app.js?v=7"></script>
</body>
</html>
