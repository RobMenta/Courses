<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#0b0f14" />

  <title>Liste de course</title>

  <!-- PWA -->
  <link rel="manifest" href="./manifest.webmanifest" />
  <link rel="apple-touch-icon" href="./assets/icon-192.png" />

  <!-- Styles (IMPORTANT : pas de CSS inline ici) -->
  <link rel="stylesheet" href="./styles.css?v=1" />
</head>

<body>
  <header class="topbar">
    <div class="brand">
      <div class="brand__dot" aria-hidden="true"></div>
      <div>
        <div class="brand__title">Liste de course</div>
        <div class="brand__sub">ğŸŸ¢ Offline â€¢ ğŸ“² Ã‰cran dâ€™accueil â€¢ ğŸ§® Total auto</div>
      </div>
    </div>

    <button id="btnSettings" class="icon-btn" title="RÃ©glages">âš™ï¸</button>
  </header>

  <main class="container">

    <!-- Tabs -->
    <nav class="tabs" role="tablist" aria-label="Navigation">
      <button class="tab is-active" role="tab" aria-selected="true" data-tab="list">ğŸ›’ Liste</button>
      <button class="tab" role="tab" aria-selected="false" data-tab="recipes">ğŸ³ Recettes â†’ Liste</button>
      <button class="tab" role="tab" aria-selected="false" data-tab="budget">ğŸ’¶ Budget â†’ Liste</button>
    </nav>

    <!-- PANEL LIST -->
    <section class="panel is-active" id="tab-list" role="tabpanel">
      <div class="panel__header">
        <h2>ğŸ›’ Ta liste</h2>
        <div class="muted">
          Coche âœ…, ajuste la quantitÃ© ğŸ”¢, mets ton prix ğŸ’¶, et le total se calcule tout seul.
          Tu peux aussi glisser â˜° pour rÃ©ordonner.
        </div>

        <div class="toolbar">
          <input id="searchInput" class="input" placeholder="(optionnel) rechercherâ€¦" />
          <button id="btnAddQuick" class="btn btn-ghost">â• Ajouter</button>
        </div>

        <div class="summary">
          <div class="summary__card">
            <div class="summary__label">ğŸ§® Total cochÃ©</div>
            <div class="summary__value"><span id="totalValue">0,00</span> â‚¬</div>
            <div class="summary__hint" id="totalHint">Coche un produit + saisis un prix pour lâ€™ajouter au total.</div>
          </div>

          <div class="summary__actions">
            <button class="btn" data-ai="suggest_from_checked">âœ¨ Recettes avec ce que jâ€™ai cochÃ©</button>
            <button class="btn btn-ghost" id="btnUncheckAll">ğŸ§¼ Tout dÃ©cocher</button>
            <button class="btn btn-ghost" id="btnResetPrices">ğŸ§¾ Vider prix</button>
            <button class="btn btn-danger" id="btnResetAll">ğŸ”¥ Reset</button>
          </div>
        </div>

        <div class="legend">
          <div class="legend__item"><span class="chip">â˜°</span> glisse</div>
          <div class="legend__item"><span class="chip">â»</span> switch</div>
          <div class="legend__item"><span class="chip">Ã—</span> quantitÃ©</div>
          <div class="legend__item"><span class="chip">â‚¬</span> prix</div>
        </div>
      </div>

      <div class="list-wrapper">
        <ul class="items" id="itemsList"></ul>

        <div class="add-row">
          <form id="addRow" hidden>
            <input id="addName" class="input" placeholder="Nom du produitâ€¦" />
            <button id="btnAddConfirm" class="btn" type="submit">âœ… Ajouter</button>
            <button id="btnAddCancel" class="btn btn-ghost" type="button">Annuler</button>
          </form>
        </div>
      </div>
    </section>

    <!-- PANEL RECIPES -->
    <section class="panel" id="tab-recipes" role="tabpanel">
      <div class="panel__header">
        <h2>ğŸ³ Recettes â†’ Liste</h2>
        <div class="muted">
          Lâ€™IA te propose des recettes qui â€œfonctionnent vraimentâ€, puis tu peux appliquer :
          Ã§a coche / ajoute / met les quantitÃ©s dans ta liste ğŸ›’
        </div>
      </div>

      <div class="ai-box">
        <div class="ai-actions">
          <button class="btn" data-ai="suggest_from_checked">ğŸ§  IdÃ©es recettes (avec ma sÃ©lection)</button>
          <button class="btn btn-ghost" data-ai="suggest_plus_2">ğŸ›ï¸ IdÃ©es + 1â€“2 achats max</button>
        </div>

        <label class="label">2) Une envie â†’ liste automatique</label>
        <textarea id="aiPromptRecipes" class="textarea" rows="3" placeholder="Ex : pÃ¢tes carbo healthy, wraps protÃ©inÃ©sâ€¦"></textarea>

        <div class="ai-actions">
          <button class="btn" data-ai="plan_recipe">âœ¨ GÃ©nÃ©rer + prÃ©parer la liste</button>
          <button class="btn btn-ghost" id="btnClearAi">ğŸ§½ Effacer</button>
        </div>

        <div class="ai-output">
          <div class="ai-output__title">ğŸ“Œ RÃ©sultat</div>

          <!-- âœ… dÃ©jÃ  en rendu HTML -->
          <div class="ai-render" id="aiOutRecipes"><div class="ai-render__empty">â€”</div></div>

          <div class="ai-output__actions">
            <button class="btn" id="btnApplyAi" disabled>âœ… Appliquer Ã  ma liste</button>
          </div>
        </div>
      </div>
    </section>

    <!-- PANEL BUDGET -->
    <section class="panel" id="tab-budget" role="tabpanel">
      <div class="panel__header">
        <h2>ğŸ’¶ Budget â†’ Liste (semaine)</h2>
        <div class="muted">
          Tu mets un budget + un objectif : lâ€™IA propose une semaine de courses. Ensuite tu peux appliquer : Ã§a coche / ajoute / quantitÃ©s.
        </div>
      </div>

      <div class="ai-box">
        <div class="grid2">
          <div>
            <label class="label">Budget (â‚¬)</label>
            <input id="budgetValue" class="input" placeholder="Ex: 80" inputmode="decimal" />
          </div>
          <div>
            <label class="label">Objectif</label>
            <select id="budgetGoal" class="select">
              <option value="equilibre">ğŸ¥— Ã‰quilibrÃ©</option>
              <option value="proteine">ğŸ’ª ProtÃ©inÃ©</option>
              <option value="perte">ğŸ”¥ Perte de poids</option>
            </select>
          </div>
        </div>

        <label class="label">Contraintes (optionnel)</label>
        <input id="aiPromptBudget" class="input" placeholder="Ex : pas de porc, pas de lactose, rapideâ€¦" />

        <div class="ai-actions">
          <button class="btn" data-ai="weekly_plan">ğŸ§¾ GÃ©nÃ©rer semaine</button>
          <button class="btn btn-ghost" id="btnClearAiBudget">ğŸ§½ Effacer</button>
        </div>

        <div class="ai-output">
          <div class="ai-output__title">ğŸ“Œ RÃ©sultat</div>

          <!-- âœ… MODIF ICI: plus de JSON brut -->
          <div class="ai-render" id="aiOutBudget"><div class="ai-render__empty">â€”</div></div>

          <div class="ai-output__actions">
            <button class="btn" id="btnApplyAiBudget" disabled>âœ… Appliquer Ã  ma liste</button>
          </div>
        </div>
      </div>
    </section>

    <!-- SETTINGS DIALOG -->
    <dialog class="dialog" id="settingsDialog">
      <form method="dialog" class="dialog__form">
        <div class="dialog__header">
          <strong>âš™ï¸ RÃ©glages</strong>
          <button class="icon-btn" value="cancel">âœ•</button>
        </div>

        <div class="dialog__body">
          <label class="label">URL backend IA (Cloudflare Worker)</label>
          <input id="aiEndpoint" class="input" placeholder="https://...workers.dev/ai" />

          <hr class="hr"/>

          <label class="label">QuantitÃ© max (menu)</label>
          <input id="qtyMax" class="input" inputmode="numeric" placeholder="10" />
        </div>

        <div class="dialog__footer">
          <button class="btn btn-ghost" value="cancel">Annuler</button>
          <button class="btn" id="btnSaveSettings" value="ok">âœ… Sauver</button>
        </div>
      </form>
    </dialog>

  </main>

  <script src="./app.js?v=1"></script>
</body>
</html>
